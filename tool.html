<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Math Tools</title>

  <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
  <style type="text/css">
  .bs-component + .bs-component {
    margin-top: 1rem;
  }
  @media (min-width: 768px) {
    .bs-docs-section {margin-top: 8em;}
    .bs-component {position: relative;}
    .bs-component .modal {
      position: relative;
      top: auto;
      right: auto;
      bottom: auto;
      left: auto;
      z-index: 1;
      display: block;
    }
    .bs-component .modal-dialog {width: 90%;}
    .bs-component .popover {
      position: relative;
      display: inline-block;
      width: 220px;
      margin: 20px;
    }
    .nav-tabs {margin-bottom: 15px;}
    .progress {margin-bottom: 10px;}
  }
  </style>
</head>

<body>
<header>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="index.html">Nozomi</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarColor02">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="about.html">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="link.html">Links</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="blog.html">Blog</a>
        </li>
        <li class="nav-item">
					<a class="nav-link" href="nhk.html">NHKWeb</a>
				</li>
        <li class="nav-item">
          <a class="nav-link" href="ipathai.html">タイ語入力</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="tool.html">Math Tools<span class="sr-only">(current)</span></a>
        </li>
      </ul>
      <!--
      <form class="form-inline my-2 my-lg-0">
        <input class="form-control mr-sm-2" type="text" placeholder="Search">
        <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
      </form>
      -->
    </div>
  </nav>
</header>

<br>
<div class="container">

  <div class="row">
    <div class="col-lg-12">
      <h2>Math Tools</h2>
    </div>
  </div>
  
  <div class="row">
    <div class="col-lg-6">
      <div class="bs-component">
        <div class="card border-secondary mb-3" style="min-height: 16rem;">
          <div class="card-header">Base Converter</div>
          <div class="card-body">
            <form onsubmit="convert();return false;">
            <table class='table'>
              <tr>
                <td>
                  <select class="form-control" id='from_base' style="min-width: 4rem;">
                    <option value=10 selected>10</option>
                    <option value=16>16</option>
                    <option value=2>2</option>
                    <option value=3>3</option>
                    <option value=4>4</option>
                    <option value=5>5</option>
                    <option value=6>6</option>
                    <option value=7>7</option>
                    <option value=8>8</option>
                    <option value=9>9</option>
                  </select>
                </td>
                <td><input type='text' class="form-control" id='from_value' placeholder="from"></td>
              </tr>
              <tr>
                <td>
                  <select class="form-control" id='to_base' style="min-width: 4rem;">
                    <option value=16 selected>16</option>
                    <option value=10>10</option>
                    <option value=2>2</option>
                    <option value=3>3</option>
                    <option value=4>4</option>
                    <option value=5>5</option>
                    <option value=6>6</option>
                    <option value=7>7</option>
                    <option value=8>8</option>
                    <option value=9>9</option>
                  </select>
                </td>
                <td>
                  <button class="btn btn-outline-secondary" onclick="convert();return false">convert</button>
                  <button class="btn btn-outline-secondary" onclick="reset_base();return false">reset</button>
                </td>
              </tr>
              <tr class="table-active">
                <td colspan="2" align="center"><strong id="answer">answer</strong></td>
              </tr>
            </table>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="bs-component">
        <div class="card border-secondary mb-3" style="min-height: 16rem;">
          <div class="card-header">GCD & LCM</div>
          <div class="card-body">
            <form onsubmit="show_gcd();return false;">
              <table class='table'>
                <tr>
                  <td colspan="2"><input type='text' class="form-control" id='gcd_input' placeholder="integers with space" autocomplete="off"></td>
                </tr>
                <tr>
                  <td>
                    <select class="form-control" id='select_gcd' style="min-width: 6rem;">
                      <option value="gcd" selected>GCD</option>
                      <option value="lcm">LCM</option>
                    </select>
                  </td>
                  <td>
                    <button class="btn btn-outline-secondary" onclick="show_gcd();return false">search</button>
                    <button class="btn btn-outline-secondary" onclick="reset_gcd();return false">reset</button>
                  </td>
                </tr>
                <tr class="table-active">
                  <td colspan="2" align="center"><strong id="answer_gcd">answer</strong></td>
                </tr>
              </table>
              </form>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="row">
    <div class="col-lg-12">
      <h2>Normal Distribution</h2>
    </div>
  </div>

  <div class="row">

    <div class="col-lg-3">
      <div class="bs-component">
        <div class="card border-success mb-3" style="min-height: 16rem;">
          <div class="card-header">z-score to P(0≤x≤z)</div>
          <div class="card-body">
            <form onsubmit="z_to_p1();return false;">
            <table class='table'>
              <tr><td><input type='text' class="form-control" id='z1' placeholder="z-score" autocomplete="off"></td></tr>
              <tr>
                <td>
                <button class="btn btn-outline-success" onclick="z_to_p1();return false">calculate</button>
                <button class="btn btn-outline-success" onclick="resetp1();return false">reset</button>
                </td>
              </tr>
              <tr class="table-active">
                <td align="center"><strong id="P1">P(0≤x≤z)</strong></td>
              </tr>
            </table>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3">
      <div class="bs-component">
        <div class="card border-success mb-3" style="min-height: 16rem;">
          <div class="card-header">z-score to P(z≤x)</div>
          <div class="card-body">
            <form onsubmit="z_to_p2();return false;">
            <table class='table'>
              <tr><td><input type='text' class="form-control" id='z2' placeholder="z-score" autocomplete="off"></td></tr>
              <tr>
                <td>
                <button class="btn btn-outline-success" onclick="z_to_p2();return false">calculate</button>
                <button class="btn btn-outline-success" onclick="resetp2();return false">reset</button>
                </td>
              </tr>
              <tr class="table-active">
                <td align="center"><strong id="P2">P(z≤x)</strong></td>
              </tr>
            </table>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3">
      <div class="bs-component">
        <div class="card border-warning mb-3" style="min-height: 16rem;">
          <div class="card-header">P(0≤x≤z) to z-score</div>
          <div class="card-body">
            <form onsubmit="p3_to_z();return false;">
            <table class='table'>
              <tr><td><input type='text' class="form-control" id='P3' placeholder="P(0≤x≤z)" autocomplete="off"></td></tr>
              <tr>
                <td>
                <button class="btn btn-outline-warning" onclick="p3_to_z();return false">calculate</button>
                <button class="btn btn-outline-warning" onclick="resetp3();return false">reset</button>
                </td>
              </tr>
              <tr class="table-active">
                <td align="center"><strong id="z3">z-score</strong></td>
              </tr>
            </table>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-3">
      <div class="bs-component">
        <div class="card border-warning mb-3" style="min-height: 16rem;">
          <div class="card-header">P(z≤x) to z-score</div>
          <div class="card-body">
            <form onsubmit="p4_to_z();return false;">
            <table class='table'>
              <tr><td><input type='text' class="form-control" id='P4' placeholder="P(z≤x)" autocomplete="off"></td></tr>
              <tr>
                <td>
                <button class="btn btn-outline-warning" onclick="p4_to_z();return false">calculate</button>
                <button class="btn btn-outline-warning" onclick="resetp4();return false">reset</button>
                </td>
              </tr>
              <tr class="table-active">
                <td align="center"><strong id="z4">z-score</strong></td>
              </tr>
            </table>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div> <!--row normal distribution-->

  <div class="row">
    <div class="col-lg-12">
      <h2>Poisson & Gamma Distribution</h2>
    </div>
  </div>
  
  <div class="row">
    <div class="col-lg-5">
      <div class="bs-component">
        <div class="card border-primary mb-3" style="min-height: 16rem;">
          <div class="card-header">Poisson Distribution</div>
          <div class="card-body">
            <form onsubmit="show_poisson();return false;">
            <table class='table'>
              <tr>
                <td><input type='text' class="form-control" id='poisson_input1' placeholder="mean times λ" autocomplete="off"></td>
                <td><input type='text' class="form-control" id='poisson_input2' placeholder="times k" autocomplete="off"></td>
              </tr>
              <tr>
                <td colspan="2">
                  <button class="btn btn-outline-primary" onclick="show_poisson();return false">calculate</button>
                  <button class="btn btn-outline-primary" onclick="reset_poisson();return false">reset</button>
                </td>
              </tr>
              <tr class="table-active">
                <td align="center"><strong id="poisson1">P(X=k)</strong></td>
                <td align="center"><strong id="poisson2">P(X≤k)</strong></td>
              </tr>
            </table>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-7">
      <div class="bs-component">
        <div class="card border-info mb-3" style="min-height: 16rem;">
          <div class="card-header">Gamma Distribution</div>
          <div class="card-body">
            <form onsubmit="show_gamma();return false;">
            <table class='table'>
              <tr>
                <td colspan="2"><input type='text' class="form-control" id='gamma_input1' placeholder="mean period θ" autocomplete="off"></td>
                <td colspan="2"><input type='text' class="form-control" id='gamma_input2' placeholder="times k" autocomplete="off"></td>
                <td colspan="2"><input type='text' class="form-control" id='gamma_input3' placeholder="time x" autocomplete="off"></td>
              </tr>
              <tr>
                <td colspan="6">
                  <button class="btn btn-outline-info" onclick="show_gamma();return false">calculate</button>
                  <button class="btn btn-outline-info" onclick="reset_gamma();return false">reset</button>
                </td>
              </tr>
              <tr class="table-active">
                <td colspan="3" align="center"><strong id="gamma1">P(x)</strong></td>
                <td colspan="3" align="center"><strong id="gamma2">P(0~x)</strong></td>
              </tr>
            </table>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div> <!--row Poisson % Gamma distribution-->

</div> <!--container-->


<script>

  // convert base
  function convert(){
      var from_base = document.getElementById('from_base').value
      var to_base = document.getElementById('to_base').value
      var from_value = document.getElementById('from_value').value
      var temp = parseInt(from_value, from_base) // m -> 10
      var answer = temp.toString(to_base) // 10 -. n
      document.getElementById('answer').innerText = answer;
  }

  // gcd algorithm
  function euclid(a,b){
    if(a < b){
      [a, b] = [b, a];
    }
    while(r!=0){
      var r = a%b;
      a = b; b = r;
    }
    return a 
  }
  function lcm2(a,b){
    return Math.round(a*b/euclid(a,b))
  }
  function gcd(nums){
    while(nums.length>1){
      var new_nums = [];
      for(var i=0;i<nums.length-1;i++){
        new_nums.push(euclid(nums[i], nums[i+1]));
      }
      nums = new_nums;
    }
    return nums[0]
  }
  function lcm(nums){
    while(nums.length>1){
      var new_nums = [];
      for(var i=0;i<nums.length-1;i++){
        new_nums.push(lcm2(nums[i], nums[i+1]));
      }
      nums = new_nums;
    }
    return nums[0]
  }
  // validate gcd
  document.getElementById('gcd_input').oninput = validation_gcd;
  function validation_gcd(){
    var nums = document.getElementById('gcd_input').value.trim().split(/\s+/).map(Number);
    if(nums.every(Number.isInteger) && !nums.includes(0)){
      document.getElementById('gcd_input').classList.remove('is-invalid')
    }else{
      document.getElementById('gcd_input').classList.add('is-invalid')
    }
  }
  function show_gcd(){
    var elem = document.getElementById('gcd_input');
    var nums = elem.value.trim().split(/\s+/).map(Number);
    var mode = document.getElementById('select_gcd').value;
    if(nums.length>0 && !elem.classList.contains('is-invalid')){
      if(mode=='gcd'){
        document.getElementById('answer_gcd').innerText = gcd(nums);
      }else{
        document.getElementById('answer_gcd').innerText = lcm(nums);
      }
      
    }
  }

  // functions for factorial, round
  function fact(n){
    if(n==0){
      return 1;
    }else{
      var product = 1;
      for(i=1;i<=n;i++){
        product *= i;
      }
      return product
    }
  }
  function round(num, f){
    return Math.round(num * (10**f)) / (10**f)
  }

  // function for integrating Gaussian (z-score -> P)
  // with Taylor expansion N=150
  function erf(z){
    var z = z/(2**0.5)
    var sum = 0;
    for(var n=0;n<=150;n++){
      var product = 1;
      for(var k=1;k<=n;k++){
        product *= -z*z/k
      }
      sum += (z * product / (2*n+1))
    }
    return sum / Math.PI**0.5
  }

  // inverse erf (P -> z-score)
  function ierf(p){
    // aray for coef
    var ck = [1]; 
    for(var k=1;k<=150;k++){
      var s=0;
      for(var m=0;m<k;m++){
        s += ck[m]*ck[k-1-m]/(m+1)/(2*m+1);
      }
      ck.push(s);
    }
    // calculate
    var total = 0
    for(var k=0;k<=150;k++){
      total += ck[k]/(2*k+1) * ((Math.PI)**0.5 * p)**(2*k+1);
    }
    return total*(2**0.5)
  }

  // validate input 
  document.getElementById('P3').oninput = validation_ptoz;
  document.getElementById('P4').oninput = validation_ptoz;
  function validation_ptoz(){
    var p3 = document.getElementById('P3').value;
    var p4 = document.getElementById('P4').value;
    if(p3!='' && (0>p3 || p3>0.5)){
      document.getElementById('P3').classList.add('is-invalid')
    }else{
      document.getElementById('P3').classList.remove('is-invalid')
    }
    if(p4!='' && (0>p4 || p4>0.5)){
      document.getElementById('P4').classList.add('is-invalid')
    }else{
      document.getElementById('P4').classList.remove('is-invalid')
    }
  }

  // functions for calcualation z<>P
  function z_to_p1(){
    var z = document.getElementById('z1').value;
    document.getElementById('P1').innerText = round(erf(z),5);
  }
  function z_to_p2(){
    var z = document.getElementById('z2').value;
    document.getElementById('P2').innerText = round(0.5-erf(z),5);
  }
  function p3_to_z(){
    var p = document.getElementById('P3').value;
    if(0<=p && p<=0.5){
      document.getElementById('z3').innerText = round(ierf(p),4);
    }else{
      alert('P must be in range [0, 0.5]')
    }
  }
  function p4_to_z(){
    var p = document.getElementById('P4').value;
    if(0<=p && p<=0.5){
      document.getElementById('z4').innerText = round(ierf(0.5-p),4);
    }else{
      alert('P must be in range [0, 0.5]')
    }
  }

  // functions for Poisson
  function calc_poisson(l,k){
    return (l**k) * (Math.E**(-l)) / fact(k)
  }
  function show_poisson(){
    var elem1 = document.getElementById('poisson_input1');
    var elem2 = document.getElementById('poisson_input2');
    if(!elem1.classList.contains('is-invalid') && !elem2.classList.contains('is-invalid')){
      var l = Math.round(elem1.value);
      var k = Math.round(elem2.value);
      var cum = 0;
      var p = 0;
      for(var i=0;i<=k;i++){
        p = calc_poisson(l,i);
        cum += p;
      }
      document.getElementById('poisson1').innerText = `P(X=${k}) = ` + round(p,4);
      document.getElementById('poisson2').innerText = `P(X≤${k}) = ` + round(cum,4);
    }
  }

  // validate poisson
  document.getElementById('poisson_input1').oninput = validation_poisson;
  document.getElementById('poisson_input2').oninput = validation_poisson;
  function validation_poisson(){
    var l = document.getElementById('poisson_input1').value;
    var k = document.getElementById('poisson_input2').value;
    if(l!='' && !Number.isInteger(Number(l))){
      document.getElementById('poisson_input1').classList.add('is-invalid')
    }else{
      document.getElementById('poisson_input1').classList.remove('is-invalid')
    }
    if(k!='' && !Number.isInteger(Number(k))){
      document.getElementById('poisson_input2').classList.add('is-invalid')
    }else{
      document.getElementById('poisson_input2').classList.remove('is-invalid')
    }
  }

  // functions for Gamma (integration)
  function calc_gamma(s){
  var delta = 0.00001;
  var area = 0;
  var oldArea = -1;
  var t = 0;
  while(t < 3 || Math.abs(area-oldArea) > Number.EPSILON){
        oldArea = area;
        area += Math.pow(t, s-1)*Math.exp(-t)*delta;
        t += delta;
    }
  return area;
  }
  function incomplete_gamma(s,x){
  var delta = 0.000001;
  var area = 0;
  var oldArea = -1;
  var t = 0;
  while(t < x){
        oldArea = area;
        area += Math.pow(t, s-1)*Math.exp(-t)*delta;
        t += delta;
    }
  return area;
  }
  // validate gamma
  document.getElementById('gamma_input1').oninput = validation_gamma;
  document.getElementById('gamma_input2').oninput = validation_gamma;
  document.getElementById('gamma_input3').oninput = validation_gamma;
  function validation_gamma(){
    var t = document.getElementById('gamma_input1').value;
    var k = document.getElementById('gamma_input2').value;
    var x = document.getElementById('gamma_input3').value;
    if(t='' || Number(t)>=0){
      document.getElementById('gamma_input1').classList.remove('is-invalid')
    }else{
      document.getElementById('gamma_input1').classList.add('is-invalid')
    }
    if(k='' || Number(k)>=0){
      document.getElementById('gamma_input2').classList.remove('is-invalid')
    }else{
      document.getElementById('gamma_input2').classList.add('is-invalid')
    }
    if(x='' || Number(x)>=0){
      document.getElementById('gamma_input3').classList.remove('is-invalid')
    }else{
      document.getElementById('gamma_input3').classList.add('is-invalid')
    }
  }
  function show_gamma(){
    var elem1 = document.getElementById('gamma_input1');
    var elem2 = document.getElementById('gamma_input2');
    var elem3 = document.getElementById('gamma_input3');
    if(!elem1.classList.contains('is-invalid') && !elem2.classList.contains('is-invalid') && !elem3.classList.contains('is-invalid')){
      var t = elem1.value;
      var k = elem2.value;
      var x = elem3.value;
      var gamma_k = calc_gamma(k);
      var p = x**(k-1)*(Math.E**(-x/t))/gamma_k/(t**k);
      var cum = incomplete_gamma(k,x/t)/gamma_k;
      document.getElementById('gamma1').innerText = 'P(x) = ' + round(p,5);
      document.getElementById('gamma2').innerText = 'P(0~x) = ' + round(cum,5);
    }
  }


  // functions for reset input form
  function reset_base(){
    document.getElementById('from_value').value = '';
    document.getElementById('answer').innerText = 'answer';
    document.getElementById('from_value').focus();
  }
  function reset_gcd(){
    document.getElementById('gcd_input').value = '';
    document.getElementById('answer_gcd').innerText = 'answer';
    document.getElementById('gcd_input').focus();
  }
  function resetp1(){
    document.getElementById('z1').value = '';
    document.getElementById('P1').innerText = 'P(0≤x≤z)';
    document.getElementById('z1').focus();
  }
  function resetp2(){
    document.getElementById('z2').value = '';
    document.getElementById('P2').innerText = 'P(z≤x)';
    document.getElementById('z2').focus();
  }
  function resetp3(){
    document.getElementById('P3').value = '';
    document.getElementById('z3').innerText = 'z-score';
    document.getElementById('P3').focus();
  }
  function resetp4(){
    document.getElementById('P4').value = '';
    document.getElementById('z4').innerText = 'z-score';
    document.getElementById('P4').focus();
  }
  function reset_poisson(){
    document.getElementById('poisson_input1').value = '';
    document.getElementById('poisson_input2').value = '';
    document.getElementById('poisson1').innerText = 'P(X=k)';
    document.getElementById('poisson2').innerText = 'P(X≤k)';
    document.getElementById('poisson_input1').focus();
  }
  function reset_gamma(){
    document.getElementById('gamma_input1').value = '';
    document.getElementById('gamma_input2').value = '';
    document.getElementById('gamma_input3').value = '';
    document.getElementById('gamma1').innerText = 'P(x)';
    document.getElementById('gamma2').innerText = 'P(0~x)';
    document.getElementById('gamma_input1').focus();
  }

</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="./js/bootstrap.min.js"></script>

<script type="text/javascript">
  $('.bs-component [data-toggle="popover"]').popover();
  $('.bs-component [data-toggle="tooltip"]').tooltip();
</script>
</body>
</html>
