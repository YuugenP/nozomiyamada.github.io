<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Phonology Tools</title>

  <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
  <style type="text/css">
  .bs-component + .bs-component {
    margin-top: 1rem;
  }
  @media (min-width: 768px) {
    .bs-docs-section {margin-top: 8em;}
    .bs-component {position: relative;}
    .bs-component .modal {
      position: relative;
      top: auto;
      right: auto;
      bottom: auto;
      left: auto;
      z-index: 1;
      display: block;
    }
    .bs-component .modal-dialog {width: 90%;}
    .bs-component .popover {
      position: relative;
      display: inline-block;
      width: 220px;
      margin: 20px;
    }
    .nav-tabs {margin-bottom: 15px;}
    .progress {margin-bottom: 10px;}
    .ipacopy:hover {cursor: pointer;}
    td{padding-right: 0.5em;}
  }
  </style>
</head>

<body>
<header>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="index.html">Nozomi</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarColor02">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="about.html">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="link.html">Links</a>
        </li>
        <li class="nav-item">
					<a class="nav-link" href="nhk.html">NHKWeb</a>
				</li>
        <li class="nav-item">
          <a class="nav-link" href="ipathai.html">タイ語入力</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="tool.html">Math Tools</a>
				</li>
				<li class="nav-item active">
          <a class="nav-link" href="phonology.html">Phonology</a>
        </li>
      </ul>
      <!--
      <form class="form-inline my-2 my-lg-0">
        <input class="form-control mr-sm-2" type="text" placeholder="Search">
        <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
      </form>
      -->
    </div>
  </nav>
</header>
	
<div class="container">

  <div class="page-header" id="banner">
    <div class="row my-3">
      <div class="col-12">
				<h2 class="display-5">Minimal Pair Searcher (EN)</h2>
        - Search by word
        <ol>
          <li>Input an English word.</li>
          <li>Press ENTER key.</li>
        </ol>
        - Search by two phonemes
        <ol>
          <li>Select two phonemes from dropdown lists.</li>
          <li>Select maximum length. (if greater than 6, it may take a long time)</li>
          <li>Select positions (<font color="blue">initial</font>, <font color="green">middle</font>, <font color="goldenrod">final</font>) of the two phonemes.</li>
          <li>Press search button.</li>
        </ol>
        IPA can be copied to clipboard just by clicking<br><br>
        other tools
        <ul>
          <li><a href="http://phonetictools.altervista.org/minimalpairfinder/" target="blank_">Minimal Pair Finder</a></li>
          <li><a href="https://lessonpix.com/minPairs.php" target="blank_">Lesson Pix</a></li>
          <li><a href="https://linguistics.ucla.edu/people/hayes/103/MinimalPairs/index.htm" target="blank_">UCLA Linguistics</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-5">
      <div class="bs-component">
				<h3>input word (not IPA)</h3>
        <form onsubmit="find_minimal(); return false;">
					<input type="text" class="form-control" id="input" placeholder="word" autocomplete="off">
				</form>
      </div>
    </div>
    <div class="col-lg-7">
      <div class="bs-component">
				<h3>select 2 phonemes</h3>
        <form onsubmit="find_minimal2(); return false;">
          <table>
            <tbody>
              <tr>
                <td>
                  <select class="form-control" id='input_ipa1' style="min-width: 3rem;">
                    <option value="i">i</option>
                    <option value="ɪ">ɪ</option>
                    <option value="u">u</option>
                    <option value="ʊ">ʊ</option>
                    <option value="e">e</option>
                    <option value="ɛ">ɛ</option>
                    <option value="æ">æ</option>
                    <option value="o">o</option>
                    <option value="ɔ">ɔ</option>
                    <option value="a">a</option>
                    <option value="ɑ">ɑ</option>
                    <option value="ə">ə</option>
                    <option value="ɝ">ɝ</option>
                    <option value="j">j</option>
                    <option value="w">w</option>
                    <option value="ɹ">ɹ</option>
                    <option value="ɫ">ɫ</option>
                    <option value="p">p</option>
                    <option value="b">b</option>
                    <option value="m">m</option>
                    <option value="f">f</option>
                    <option value="v">v</option>
                    <option value="θ">θ</option>
                    <option value="ð">ð</option>
                    <option value="t">t</option>
                    <option value="d">d</option>
                    <option value="n">n</option>
                    <option value="s">s</option>
                    <option value="z">z</option>
                    <option value="ʃ">ʃ</option>
                    <option value="ʒ">ʒ</option>
                    <option value="ʧ">ʧ</option>
                    <option value="ʤ">ʤ</option>
                    <option value="k">k</option>
                    <option value="ɡ">ɡ</option>
                    <option value="ŋ">ŋ</option>
                    <option value="h">h</option>
                  </select>
                </td>
                <td>
                  <select class="form-control" id='input_ipa2' style="min-width: 3rem;">
                    <option value="i">i</option>
                    <option value="ɪ">ɪ</option>
                    <option value="u" selected>u</option>
                    <option value="ʊ">ʊ</option>
                    <option value="e">e</option>
                    <option value="ɛ">ɛ</option>
                    <option value="æ">æ</option>
                    <option value="o">o</option>
                    <option value="ɔ">ɔ</option>
                    <option value="a">a</option>
                    <option value="ɑ">ɑ</option>
                    <option value="ə">ə</option>
                    <option value="ɝ">ɝ</option>
                    <option value="j">j</option>
                    <option value="w">w</option>
                    <option value="ɹ">ɹ</option>
                    <option value="ɫ">ɫ</option>
                    <option value="p">p</option>
                    <option value="b">b</option>
                    <option value="m">m</option>
                    <option value="f">f</option>
                    <option value="v">v</option>
                    <option value="θ">θ</option>
                    <option value="ð">ð</option>
                    <option value="t">t</option>
                    <option value="d">d</option>
                    <option value="n">n</option>
                    <option value="s">s</option>
                    <option value="z">z</option>
                    <option value="ʃ">ʃ</option>
                    <option value="ʒ">ʒ</option>
                    <option value="ʧ">ʧ</option>
                    <option value="ʤ">ʤ</option>
                    <option value="k">k</option>
                    <option value="ɡ">ɡ</option>
                    <option value="ŋ">ŋ</option>
                    <option value="h">h</option>
                  </select>
                </td>
                <td>
                  <select class="form-control" id='maxlength' style="min-width: 3rem;">
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5" selected>5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>
                </td>
                <td>
                  <input type="checkbox" id="initial" checked><label for="initial">&nbsp;<font color="blue">initial</font>&nbsp;</label>
                  <input type="checkbox" id="middle"><label for="middle">&nbsp;<font color="green">middle</font>&nbsp;</label>
                  <input type="checkbox" id="final"><label for="final">&nbsp;<font color="goldenrod">final</font>&nbsp;</label>
                </td>
                <td>
                  <input type="submit" class="btn btn-outline-secondary" onclick="find_minimal2();return false;" value="search">
                </td>
              </tr>
            </tbody>
          </table>
				</form>
      </div>
		</div>
	</div><br>

	<div class="row">
    <div class="col-lg-12">
      <div class="bs-component">
				<h3>Results</h3>
				<table class="table table-hover">
					<tbody id="result_table">
						<tr>
							<th>IPA of input</th>
							<th>minimal pair (IPA)</th>
							<th>minimal pair (word)</th>
						</tr>
					</tbody>
				</table>
      </div>
		</div>
	</div>
	
</div>
<br>


<footer>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <p><font color="white">&copy; 2020 Nozomi Yamada All Rights Reserved.</font></p>
  </nav>
</footer>

<script src="js/minimalpair.js"></script>
<script>
	function find_minimal(){
		let word = document.getElementById('input').value.trim().toLowerCase();
		document.getElementById('result_table').innerHTML = '<tr><th>IPA of input</th><th>minimal pair (IPA)</th><th>minimal pair (word)</th></tr>';
		if((word in WORD2IPA) === false){
			document.getElementById('result_table').insertAdjacentHTML('beforeend', '<td colspan="3">INPUT WORD NOT FOUND</td>');
		}else{
      for(ipa of WORD2IPA[word]){ // iterate candidate IPA
        var found_minimal = false;
				for(var i=0; i<ipa.length; i++){ // change one character
					var pat = new RegExp('^' + ipa.slice(0,i) + '.' + ipa.slice(i+1)+'$');
					for(key in IPA2WORD){
						if(key.match(pat) && ipa!==key){
              words = IPA2WORD[key];
              key = key.replace('ʧ','tʃ').replace('ʤ','dʒ');
              ipa = ipa.replace('ʧ','tʃ').replace('ʤ','dʒ');
							var insert_html = `<tr><td class="ipacopy" onclick="copy_to_clipboard();">${ipa}</td><td class="ipacopy" onclick="copy_to_clipboard();">${key}</td><td>${words.join(', ')}</td>`;
              document.getElementById('result_table').insertAdjacentHTML('beforeend', insert_html); 
              found_minimal = true;
						}
					}
        }
        if(found_minimal===false){
          document.getElementById('result_table').insertAdjacentHTML('beforeend', `<td class="ipacopy" onclick="copy_to_clipboard();">${ipa}</td><td colspan="2">MINIMAL PAIR NOT FOUND</td>`);
        }
      }
		}
  }

  function find_minimal2(){
    let ipa1 = document.getElementById('input_ipa1').value;
    let ipa2 = document.getElementById('input_ipa2').value;
    let is_initial = document.getElementById("initial").checked;
    let is_middle = document.getElementById("middle").checked;
    let is_final = document.getElementById("final").checked;
    let maxlength = document.getElementById('maxlength').value;
    document.getElementById('result_table').innerHTML = '<tr><th>IPA 1</th><th>IPA 2</th><th>minimal pair (word)</th></tr><tr id="initial_row" style="display:none;"></tr><tr id="middle_row" style="display:none;"></tr><tr id="final_row" style="display:none;"></tr>'
    let candidates1 = Object.keys(IPA2WORD).filter(x => x.match(ipa1) && x.length<=maxlength && x.length>=2); // All IPA contain input ipa1
    let candidates2 = Object.keys(IPA2WORD).filter(x => x.match(ipa2) && x.length<=maxlength && x.length>=2); // All IPA contain input ipa2
    
    let found_minimal = false;
    for(cand1 of candidates1){ // iterate candidate IPA
      // initial position
      if(is_initial===true && cand1[0]===ipa1){
        var pat = ipa2 + cand1.slice(1)
        for(cand2 of candidates2){
          if(pat === cand2){
            words1 = IPA2WORD[cand1];
            words2 = IPA2WORD[cand2];
            cand1 = cand1.replace('ʧ','tʃ').replace('ʤ','dʒ');
            cand2 = cand2.replace('ʧ','tʃ').replace('ʤ','dʒ');
            var insert_html = `<tr class="table-primary"><td class="ipacopy" onclick="copy_to_clipboard();">${cand1}</td><td class="ipacopy" onclick="copy_to_clipboard();">${cand2}</td><td>${words1.join(', ')} / ${words2.join(', ')}</td>`;
            document.getElementById('initial_row').insertAdjacentHTML('afterend', insert_html); 
            found_minimal = true;
          }
        }
      }
      // middle position
      if(is_middle===true){
        for(var i=1; i<cand1.length-1; i++){ // change one character
          if(cand1[i]!==ipa1){continue;}
          pat = cand1.slice(0,i) + ipa2 + cand1.slice(i+1);
          for(cand2 of candidates2){
            if(pat===cand2){
              words1 = IPA2WORD[cand1];
              words2 = IPA2WORD[cand2];
              cand1 = cand1.replace('ʧ','tʃ').replace('ʤ','dʒ');
              cand2 = cand2.replace('ʧ','tʃ').replace('ʤ','dʒ');
              var insert_html = `<tr class="table-success"><td class="ipacopy" onclick="copy_to_clipboard();">${cand1}</td><td class="ipacopy" onclick="copy_to_clipboard();">${cand2}</td><td>${words1.join(', ')} / ${words2.join(', ')}</td>`;
              document.getElementById('middle_row').insertAdjacentHTML('afterend', insert_html); 
              found_minimal = true;
            }
          }
        }
      }
      // final position
      if(is_final===true && cand1.slice(-1)[0]===ipa1){
        var pat = cand1.slice(0, cand1.length-1) + ipa2;
        for(cand2 of candidates2){
          if(pat === cand2){
            words1 = IPA2WORD[cand1];
            words2 = IPA2WORD[cand2];
            cand1 = cand1.replace('ʧ','tʃ').replace('ʤ','dʒ');
            cand2 = cand2.replace('ʧ','tʃ').replace('ʤ','dʒ');
            var insert_html = `<tr class="table-warning"><td class="ipacopy" onclick="copy_to_clipboard();">${cand1}</td><td class="ipacopy" onclick="copy_to_clipboard();">${cand2}</td><td>${words1.join(', ')} / ${words2.join(', ')}</td>`;
            document.getElementById('final_row').insertAdjacentHTML('afterend', insert_html); 
            found_minimal = true;
          }
        }
      }
    }
    if(found_minimal===false){
      document.getElementById('result_table').insertAdjacentHTML('beforeend', '<td colspan="3">NOT FOUND</td>');
    }
  }
  
  function copy_to_clipboard(){
    var temp_elem = document.createElement("textarea");
    temp_elem.textContent = event.target.innerText;
    var body_elem = document.getElementsByTagName("body")[0];
    body_elem.appendChild(temp_elem);
    temp_elem.select();
    document.execCommand("Copy");
    temp_elem.remove();
  }
</script>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="./js/bootstrap.min.js"></script>

<script type="text/javascript">
  $('.bs-component [data-toggle="popover"]').popover();
  $('.bs-component [data-toggle="tooltip"]').tooltip();
</script>

</body>
</html>
